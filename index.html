
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>Automatyczne testy funkcjonalne na sterydach</title>
  <script src="../../bower_components/webcomponentsjs/webcomponents-lite.js"></script>
  <link rel="import" href="../../elements/codelab.html">
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <style is="custom-style">
    body {
      font-family: "Roboto",sans-serif;
      background: var(--google-codelab-background, #F8F9FA);
    }
  </style>
  
</head>
<body unresolved class="fullbleed">

  <google-codelab title="Automatyczne testy funkcjonalne na sterydach"
                  environment="web"
                  feedback-link="https://github.com/jaworj/steroids_workshops">
    
      <google-codelab-step label="Wstęp" duration="0">
        <p>Ludziska słuchajta! Tu jest zarąbisty wstęp do warsztatów. Piękna proza o tym czego się nauczycie. I coś o nas. Strzeliliśmy też fancy foty i krótkie info skąd i dokąd zmierzamy.</p>
<table>
<tr><td colspan="1" rowspan="1"><p><img style="max-width: 145.00px" src="img/da909f7259c824fb.png"></p>
</td><td colspan="1" rowspan="1"><p><img style="max-width: 143.00px" src="img/20c966dcb40826a0.png"></p>
</td><td colspan="1" rowspan="1"><p><img style="max-width: 130.00px" src="img/fefb95e9f6bcc0fc.png"></p>
</td><td colspan="1" rowspan="1"><p><img style="max-width: 129.98px" src="img/5f992b9affdf3287.png"></p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Michalina Ożibko</p>
</td><td colspan="1" rowspan="1"><p>Tomasz Wojciechowski</p>
</td><td colspan="1" rowspan="1"><p>Oskar Kleska</p>
</td><td colspan="1" rowspan="1"><p>Jacek Jaworski</p>
</td></tr>
<tr><td colspan="1" rowspan="1"><p>Sukienki i pączki</p>
</td><td colspan="1" rowspan="1"><p>Ruda broda i wyjątkowo </p>
<p>czuły bullshitometr</p>
</td><td colspan="1" rowspan="1"><p>Kleskę przekuł w sukces</p>
</td><td colspan="1" rowspan="1"><p>Jakość i League of Legends</p>
</td></tr>
</table>
<h2><strong>Co to za ludzie?</strong></h2>
<p>Jesteśmy czwórką zapaleńców, pracujących w firmie, która rozwiązaniami jakościowymi ściga takich gigantów jak Google czy Facebook. Nie akceptujemy statusu quo.</p>
<h2><strong>Co zrobisz</strong></h2>
<table>
<tr><td colspan="1" rowspan="1"><p>W trakcie warsztatów wzbogacisz wcześniej przygotowany projekt oparty o Selenium o :</p>
<ul>
<li>Walidację maili</li>
<li>Walidację layoutów</li>
<li>Walidację wydajności</li>
</ul>
</td></tr>
</table>
<h2><strong>Czego się nauczysz</strong></h2>
<ul>
<li>Jak rozbudować framework testowy o automatyczne checki maili, layoutów i wydajności</li>
<li>Poznasz więcej możliwości testów E2E</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Setup" duration="0">
        <h2><strong>Czego potrzebujesz:</strong></h2>
<table>
<tr></tr>
</table>
<h3><strong>Java 8</strong></h3>
<p><a href="http://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank"><paper-button class="colored" raised>Pobierz Java 8</paper-button></a> </p>
<p>Po zainstalowaniu upewnij się że setup jest poprawny wpisując w konsoli:</p>
<pre>java -version</pre>
<p>Jeżeli wszystko jest ok, powinieneś zobaczyć mniej więcej coś takiego:</p>
<pre>java version &#34;1.8.0_144&#34;
Java(TM) SE Runtime Environment (build 1.8.0_144-b01)
Java HotSpot(TM) 64-Bit Server VM (build 25.144-b01, mixed mode)</pre>
<h3><strong>Chrome</strong></h3>
<p><a href="https://www.google.com/chrome/" target="_blank"><paper-button class="colored" raised>Pobierz najnowszą wersję Chrome</paper-button></a> </p>
<h3><strong>IntelliJ IDEA</strong></h3>
<aside class="special"><p>To pracy przy projektach związanych z automatyzacją testów, w zupełności wystarczy Community Edition.</p>
</aside>
<p><a href="https://www.jetbrains.com/idea/download/download-thanks.html?platform=mac&code=IIC" target="_blank"><paper-button class="colored" raised>Pobierz Intelij IDEA Community Edition</paper-button></a></p>
<ul>
<li>Do tego potrzebujemy plugin do IDE odpowiedzialny za ogarnięcie BDD i Cucumbera </li>
<li>Po uruchomieniu IDE użyj skrótu klawiszowego ⇧⌘A (⇧+Ctrl+A dla Windowsa) i wyszukaj menu ‘Plugins&#39;. </li>
<li>W wyszukiwarce pluginów wpisz ‘Cucumber&#39;, następnie kliknij ‘Search in repositories&#39;. Zainstaluj ‘Cucumber for Java&#39;</li>
</ul>
<p><img style="max-width: 735.28px" src="img/7b4e70e1dafe2328.png"></p>
<h2><strong>Repo:</strong></h2>
<p>Projekt, na którym będziemy pracować znajduje się tu:</p>
<p><a href="https://github.com/jaworj/steroids_workshops/tree/start" target="_blank"><paper-button class="colored" raised>Selenium On Steroids Github Repo</paper-button></a></p>
<p>Zostawiamy Tobie jak go sobie wciągniesz do IDE. Po zasetupowaniu projektu (rozwiązywanie dependencji może chwilę potrwać) znajdź w projekcie plik JobAgentConfirmation.feature i spróbuj go uruchomić <img style="max-width: 20.00px" src="img/4cf44a8214394872.png"></p>
<p>Po chwili powinieneś zobaczyć okno Chrome&#39;a wyskakujące znienacka i wbijające na jakąś stronę z dopiskiem &#34;chrome is being controlled by automated test software&#34;. Now we&#39;re talkin!</p>


      </google-codelab-step>
    
      <google-codelab-step label="Walidacja emaili" duration="0">
        <h2><strong>Inbucket</strong></h2>
<p><a href="https://www.inbucket.org/about/" target="_blank"><paper-button class="colored" raised>Inbucket - about</paper-button></a></p>
<p>W dużym skrócie - aplikacja do odbierania i wyświetlania maili. </p>
<ul>
<li>Dostęp z sieci lokalnej lub Twojego komputera</li>
<li>Żadnych haseł</li>
<li>Żadnego tworzenia skrzynek do testów</li>
<li>Żadnego zewnętrznego serwera POP3/SMTP</li>
<li>Automatyczne czyszczenie skrzynek</li>
</ul>
<h2><strong>Okej... I jak to działa?</strong></h2>
<p>Bez wchodzenia w techniczne szczegóły, możesz wysłać maila i odebrać maila używając <strong>dowolnej</strong> skrzynki i domeny, pod którą jest postawiony Inbucket. Na tych warsztatach, użyjemy instancji utworzonej w AWS i domyślnej domeny.</p>
<p><strong>Przykład:</strong></p>
<table>
<tr><td colspan="1" rowspan="1"><p><em>Adres mailowy:</em></p>
<p><a href="mailto:welcome@ec2-34-244-6-12.eu-west-1.compute.amazonaws.com" target="_blank"><em>welcome@ec2-34-244-6-12.eu-west-1.compute.amazonaws.com</em></a></p>
</td></tr>
</table>
<table>
<tr><td colspan="1" rowspan="1"><p><em>Link do skrzynki:</em></p>
<p><em>http://ec2-34-244-6-12.eu-west-1.compute.amazonaws.com/mailbox?name=welcome</em></p>
</td></tr>
</table>
<h2><strong>I mam to wszystko sprawdzać manualnie...? </strong></h2>
<p>Oczywiście, że nie! Inbucket Java Client, który napisaliśmy, umożliwia Ci komunikację z serwerem Inbucketa i... używanie go w testach. </p>
<p><a href="https://github.com/stepstone-tech/inbucket-java-client" target="_blank"><paper-button class="colored" raised>Inbucket Java Client</paper-button></a></p>
<h2><strong>Email as page</strong></h2>
<p>Pisanie testów Selenium dla statycznej strony jest bardzo proste, prawda? Czy w przypadku emaila wygląda to inaczej? Nie, jeśli używasz Inbucketa. </p>
<p>Widok HTML w Inbuckecie pozwala na wyświetlenie emaila dokładnie tak samo, jak każdej innej statycznej strony. To znaczy, że jeśli używasz <a href="https://www.pluralsight.com/guides/software-engineering-best-practices/getting-started-with-page-object-pattern-for-your-selenium-tests" target="_blank">PageObjectPattern</a>, musisz utworzyć PageObject dla emaila, którego chcesz sprawdzić. Przykład? Plik JobAgentConfirmationEmailPage w warsztatowym repo. </p>
<h2><strong>PARTY TIME!</strong></h2>
<pre>Przełącz się na brancha EmailValidation</pre>
<ol type="1" start="1">
<li>W klasie <em>JobAgentConfirmationEmailPage.java </em>znajdziesz metodę <em>confirmEmailMessageFistep</em>, w której brakuje części odpowiedzialnej za kliknięcie w przycisk potwierdzający założenie konta/subskrypcję. Nie wiem co za leń nie dopisał tej jednej linijki, ale wszyscy poszli na kebsa i jesteś jedyną osobą, która może to naprawić. </li>
<li>Stażysta piszący metodę <em>getMessageUrl </em>w klasie <em>EmailChecker.java</em> nie wiedział jak wygląda url do HTML&#39;owej wersji, pomożesz mu? Firma <em>JanuszPolExDevelopment &amp; Studenci</em> zawsze daje możliwość wyboru, więc jeśli odpowiesz &#34;nie&#34;, pan Zbysiu odprowadzi Cię do wyjścia. </li>
</ol>


      </google-codelab-step>
    
      <google-codelab-step label="Walidacja layoutu" duration="0">
        <h2><strong>Czym jest Galen ?</strong></h2>
<p><a href="http://galenframework.com/" target="_blank"><paper-button class="colored" raised>Galen framework</paper-button></a></p>
<p>Galen jest bardzo prostym frameworkiem służącym do testowania wyglądu strony. Jego prostota polega na tym, że większość pracy niezbędna do uruchomienia testu sprowadza się do napisania pliku spec, który jest swoistą &#34;mapą strony&#34;. W pliku tym deklarujemy obiekty i relacje między nimi. Zabierzmy się więc do roboty ...</p>
<h2><strong>Przygotujmy plik spec dla naszego projektu..</strong></h2>
<aside class="warning"><p><strong>Ćwiczenie:</strong></p>
<p>Sprawdź czy header strony ma wysokość 54 pixeli.</p>
<p>Sprawdź czy niebieski header maila zawiera tekst &#34;Sehr geehrter StepStone Nutzer!&#34;</p>
<p>Sprawdź czy niebieski header maila znajduje się poniżej headera strony w odległości zawierającej się w przedziale 10 - 14 pixeli.</p>
</aside>
<p><strong>Rozwiązanie:</strong></p>
<p>1. W dowolnym edytorze tekstowym stwórz plik o nazwie email.gsec i zamieść go w projekcie w lokalizacji:</p>
<p>steroids_workshops/src/test/resources/com/steroids/example/specs/</p>
<p>2. W tym pliku zdefiniuj obiekty, które chcesz przetestować. Zacznij od słowa kluczowego objects:</p>
<pre><code>  @objects</code></pre>
<p>Teraz pora na zadeklarowanie obiektów. Możesz to zrobić używając id, css lub xpath. </p>
<pre><code>  @objects
     menu css ul.menu</code></pre>
<p>To tylko przykład. Zrób to samo dla elementów maila, które chcemy przetestować (headery).</p>
<p>3. Utwórz sekcję by nadać strukturę swoim poczynaniom. Robi się to tak:</p>
<pre><code>  = Menu =</code></pre>
<p>Utwórz sekcję dla naszego przykładu.</p>
<p>4. A teraz mięcho. Opiszmy relacje między zadeklarowanymi elementami. Za chwilkę nasz test będzie gotowy do odpalenia. Poniżej masz bardzo prosty przykład. </p>
<pre><code>  = Menu =
    @on mobile
        menu:
            height 300 px 

    @on desktop
        menu:
            height 40 px </code></pre>
<h2><strong>Hint:</strong></h2>
<p>Do napisania testu z zadania wystarczą Ci słowa kluczowe:</p>
<p>height</p>
<p>text is</p>
<p>below</p>
<p>Po więcej zajrzyj tutaj:</p>
<p><a href="http://galenframework.com/docs/reference-galen-spec-language-guide/" target="_blank"><paper-button class="colored" raised>Galen Specs Language Guide</paper-button></a>.</p>
<h2>Test passed ... i co dalej ?</h2>
<p>Sama informacja, że testy przeszły często nie wystarczy. </p>
<p>Rzućmy okiem na :</p>
<ul>
<li>Raport z testów</li>
<li>Heat mapę</li>
</ul>
<h2><strong>Protip</strong></h2>
<p>Zajrzyj do katalogu target i otwórz 1-confirmation-email-layout.html. Voila!</p>


      </google-codelab-step>
    
      <google-codelab-step label="Walidacja wydajności" duration="0">
        <p><img style="max-width: 785.50px" src="img/1890931285e17627.png"></p>
<p><strong>Wydajność ma znaczenie.</strong></p>
<p>Do zmierzenie wydajności naszej strony wykorzystamy <a href="https://developer.mozilla.org/en-US/docs/Web/API/Navigation_timing_API" target="_blank">Navigation Timing API</a>.</p>
<p>Owe API dostępne jest we wszystkich współczesnych przeglądarkach, choć nadal zaskakująco dużo osób o nim nie słyszało. </p>
<p><strong>Rozgrzewka:</strong></p>
<p>Wejdź na dowolną stronę, otwórz narzędzia deweloperskie i w zakładce konsola wpisz:</p>
<pre><code>window.performance.timing</code></pre>
<p>Konsola powinna wypluć coś takiego:</p>
<pre><code>PerformanceTiming {navigationStart: 1524081709253, unloadEventStart: 0, unloadEventEnd: 0, redirectStart: 0, redirectEnd: 0, ...}</code></pre>
<p>Ta zwrotka to punkty w czasie w których wystąpiły dane atrybuty requestu, wyrażone w czasie uniksowym. </p>
<aside class="special"><p><strong>Czas uniksowy</strong> - system reprezentacji czasu mierzący liczbę sekund od początku <a href="https://pl.wikipedia.org/wiki/1970" target="_blank">1970</a> roku <a href="https://pl.wikipedia.org/wiki/Uniwersalny_czas_koordynowany" target="_blank">UTC</a>, czyli od chwili zwanej początkiem epoki Uniksa (ang. <em>Unix Epoch</em>).</p>
</aside>
<p>Atrybuty zdefiniowane w API:</p>
<p><img style="max-width: 624.00px" src="img/85d75077954c6d1b.png"></p>
<aside class="warning"><p><strong>Ćwiczenie:</strong></p>
<p>Dodać step który zbierze informacje o wydajności ze strony na której aktualnie jest test.</p>
<p>Wykorzystamy do tego:</p>
<p><strong>JavascriptExecutor</strong> - natywny mechanizm Selnium pozwalający wykonać dowolny JavaScript na stronie. </p>
<p><strong>Navigation Timing API</strong> - opisany wyżej</p>
<p><strong>GSON</strong> - googlowska biblioteka do serializacji / deserializacji Jsonów</p>
</aside>
<p>Zacznijmy od dodania stepu.</p>
<p>W pliku JobAgentConfirmation.feature dopisz na końcu </p>
<pre><code>Then   I check performance</code></pre>
<p>Następnie w klasie HomePageStep znajdź komentarz :</p>
<pre><code>//TODO: wydajność ma znaczenie</code></pre>
<p>Utwórz metodę checkPerf. Metoda ma być publiczna i nie zwracać nic czyli typu void.</p>
<pre><code>public void checkPerf() {
}</code></pre>
<p>Powinna też mieć referencję do stepu w feature file.  </p>
<pre><code>@Then(&#34;^I check performance$&#34;)</code></pre>
<p>W samej metodzie wywołaj metodę checkPerformance() z klasy HomePage.</p>
<p>Tak, tej metody jeszcze nie ma, za chwilę ją napiszesz. </p>
<p>Na tą chwilę powinno to wyglądać tak:</p>
<pre><code> @Then(&#34;^I check performance$&#34;)
  public void checkPerf() {
    homePage.checkPerformance();
  }</code></pre>
<p>W klasie HomePage dodaj brakującą metodę checkPerformance():</p>
<pre><code>public void checkPerformance() {}</code></pre>
<p>W pierwszej kolejności musimy wykonać skrypt który wyciągnie dane o wydajności. </p>
<p>Wykorzystamy do tego JavascriptExecutor - mechanizm wbudowany w Selenium służący włąśnie do wykonawania js&#39;ów na podczas testu. </p>
<p>W metodzie checkPerformance() zainicjalizujmy JavascriptExecutora&#39;a dodając:</p>
<pre><code>JavascriptExecutor js = (JavascriptExecutor) getDriver();</code></pre>
<p>Nastętpnie wykonajmy skrypt, korzystając z metody ‘executeScript&#39;, jednocześnie zamieniając go na string&#39;a:<br></p>
<pre><code>String timings =  
js.executeScript(&#34;return (window.performance.timing)&#34;).toString();</code></pre>
<p>Ok, mamy string&#39;a z czasami. Teraz wyciągnijmy konkretne wartości i dokonajmy potrzebnych obliczeń. </p>
<pre><code>Gson gson = new Gson();
Timings timingsJson = gson.fromJson(timings, Timings.class);
long pageLoadTime = timingsJson.loadEventStart - timingsJson.navigationStart;
long backendTime = timingsJson.responseStart - timingsJson.navigationStart;</code></pre>
<p>Na koniec wyświetlmy wyniki naszych obliczeń. Na potrzeby warsztatów wyrzucimy je do konsoli. </p>
<pre><code>logInfo(&#34;pageLoadTime: &#34; + pageLoadTime);
logInfo(&#34;backendTime: &#34; + backendTime);</code></pre>
<p>Całość powinna wyglądać tak:</p>
<pre><code>  public void checkPerformance() {
    JavascriptExecutor js = (JavascriptExecutor) getDriver();
    String timings =  js.executeScript(&#34;return (window.performance.timing)&#34;).toString();
    Gson gson = new Gson();
    Timings timingsJson = gson.fromJson(timings, Timings.class);
    long pageLoadTime = timingsJson.loadEventStart - timingsJson.navigationStart;
    long backendTime = timingsJson.responseStart - timingsJson.navigationStart;
    logInfo(&#34;pageLoadTime: &#34; + pageLoadTime);
    logInfo(&#34;backendTime: &#34; + backendTime);
  }</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Piękna proza na zakończenie" duration="0">
        <p>Podsumowując: napisaliście kawałek fajnego kodu, który możecie zabrać do firmy i coś z nim zrobić. Sprawdzić maila używając Inbucketa, layout Galenem, performance Navigation Timing API. </p>
<p>To jednak wierzchołek góry lodowej. Pod Selenium można podpiąć takie rzeczy jak notyfikacje na Slacku, przechwytywanie requestów http (tracking) czy wysyłanie danych performance do systemów monitorujących i wiele więcej. </p>
<p>Mało? Głodny wiedzy, a może masz z czymś problem? Tutaj możesz znaleźć kontakt do nas i obserwować terminy następnych warsztatów.</p>
<p>Tomek: <a href="https://www.linkedin.com/in/beardedqa/" target="_blank">https://www.linkedin.com/in/beardedqa/</a></p>
<p>Jacek: <a href="https://www.linkedin.com/in/tomektolama" target="_blank">www.linkedin.com/in/tomektolama</a></p>
<p>Michalina: <a href="http://www.linkedin.com/in/jacekitomekmuszadorosnac" target="_blank">www.linkedin.com/in/jacekitomekmuszadorosnac</a> </p>
<p>Oskar: <a href="http://www.linkedin.com/in/oskar-kleska" target="_blank">www.linkedin.com/in/oskar-kleska</a></p>


      </google-codelab-step>
    
  </google-codelab>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-49880327-14', 'auto');

    (function() {
      var gaCodelab = '';
      if (gaCodelab) {
        ga('create', gaCodelab, 'auto', {name: 'codelab'});
      }

      var gaView;
      var parts = location.search.substring(1).split('&');
      for (var i = 0; i < parts.length; i++) {
        var param = parts[i].split('=');
        if (param[0] === 'viewga') {
          gaView = param[1];
          break;
        }
      }
      if (gaView && gaView !== gaCodelab) {
        ga('create', gaView, 'auto', {name: 'view'});
      }
    })();
  </script>

</body>
</html>
